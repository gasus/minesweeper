(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}})();const r=(t,e)=>{const n=document.createElement(t);return e&&Object.entries(e).forEach(([o,s])=>{n.setAttribute(o,s)}),n},_=(t,e,n)=>{const o=Number(t.split(e)[0]),s=Number(t.split(e)[1]);return[{row:o-1,cell:s},{row:o-1,cell:s+1},{row:o,cell:s+1},{row:o+1,cell:s+1},{row:o+1,cell:s},{row:o+1,cell:s-1},{row:o,cell:s-1},{row:o-1,cell:s-1}].filter(i=>i.row>=1&&i.cell>=1&&i.row<=n&&i.cell<=n).map(i=>`${i.row}${e}${i.cell}`)},A=t=>{for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t},B=(t,e)=>{const n=Math.ceil(t.length*e);return A([...t]).slice(0,n)},F=t=>{const e={1:"#fff",2:"#ffe25a",3:"#19ff6f",4:"#6445bf",5:"#b72788",6:"#b40000",7:"#ab5c23",8:"#000"};return e[t]??e[1]},v="_",M="💣",$="💥",H="🚩",G=120,x=60,P=500;let y=!0,h="6",R="5",j="20",S=.15,c={},g,b=null,I=!1;const m=document.querySelector("#app"),f=r("div",{class:"game-field"}),D="ontouchstart"in window&&"ontouchend"in window,q=t=>{f.innerHTML="";const e=window.innerWidth-20,n=window.innerHeight-G,o=n>e?e:n,s=Math.floor(o/t),l=s>x?x:s,i=Math.floor(l*.7);for(let u=1;u<=t;u++){const w=r("div",{class:"row"});for(let p=1;p<=t;p++){const a=`${u}${v}${p}`,d=r("div",{class:"cell cell-closed","data-id":a});d.style.height=`${l}px`,d.style.width=`${l}px`,d.style.fontSize=`${i}px`,d.style.lineHeight=`${i}px`,w.appendChild(d),c[a]={isOpen:!1,isFlag:!1,isBomb:!1,nearBombsCount:0}}f.appendChild(w)}},C=()=>{y=!0,c={},q(Number(h))},U=t=>{const e=Object.keys(c).filter(o=>o!==t),n=B(e,S);n.forEach(o=>{c[o]={...c[o],isBomb:!0}}),g=Number(h)*Number(h)-n.length,Object.keys(c).forEach(o=>{const s=_(o,v,Number(h));let l=0;s.forEach(i=>{c[i].isBomb&&l++}),c[o]={...c[o],nearBombsCount:l}})},L=t=>{const e={win:{text:"Победа",class:"finish-screen-message-win"},defeat:{text:"Поражение",class:"finish-screen-message-defeat"}},n=r("div",{class:"finish-screen"}),o=r("div",{class:`finish-screen-message ${e[t].class}`});o.textContent=e[t].text,n.appendChild(o),f.appendChild(n)},N=t=>{const e=document.querySelector(`[data-id="${t}"]`);if(!(c[t].isFlag||!e)){if(c[t].isBomb){e.setAttribute("class","cell cell-boom"),e.textContent=$,Object.entries(c).forEach(([n,o])=>{if(o.isBomb&&n!==t){const s=document.querySelector(`[data-id="${n}"]`);s.textContent=M,o.isFlag?s.setAttribute("class","cell cell-bomb-with-flag"):s.setAttribute("class","cell cell-bomb")}}),L("defeat");return}if(!c[t].isOpen){e==null||e.setAttribute("class","cell cell-open"),c[t]={...c[t],isOpen:!0},g&&g--;const n=c[t].nearBombsCount;n&&e?(e.textContent=String(n),e.style.color=F(String(n))):!n&&e&&_(t,v,Number(h)).forEach(s=>N(s))}g===0&&L("win")}},W=t=>{const e=r("div",{class:"settings-wrapper"}),n=r("fieldset"),o=r("legend",{class:"legend-text"});o.textContent="Размер поля:";const s=r("input",{type:"range",min:R,max:j,value:h});s.addEventListener("input",a=>{var d;h=(d=a.target)==null?void 0:d.value,C()}),n==null||n.appendChild(o),n==null||n.appendChild(s);const l=r("fieldset"),i=r("legend",{class:"legend-text"});i.textContent="Уровень сложности:",l==null||l.appendChild(i);const u=r("div",{class:"difficulty-radio-wrapper"});[{id:"1",label:"Очень легко",percent:.1},{id:"2",label:"Легко",percent:.15},{id:"3",label:"Нормально",percent:.2},{id:"4",label:"Сложно",percent:.25},{id:"5",label:"Крайне сложно",percent:.3}].forEach(a=>{const d=r("div",{class:"difficulty-radio-element"}),E=r("input",{type:"radio",name:"difficulty-radio",id:a.id,value:String(a.percent),class:"difficulty-radio-element-checkbox"});E.checked=S===a.percent,E.addEventListener("change",()=>{S=a.percent,C()});const O=r("label",{for:a.id});O.textContent=a.label,d.appendChild(E),d.appendChild(O),u==null||u.appendChild(d)}),l==null||l.appendChild(u);const p=r("button",{});p.innerText="Перезапустить",p.addEventListener("click",()=>{C()}),e.appendChild(n),e.appendChild(l),e.appendChild(p),t==null||t.appendChild(e)};f.addEventListener("click",t=>{const n=t.target.dataset.id;n&&(y&&(y=!1,U(n)),N(n))});const T=t=>{const e=t.target,n=e.dataset.id;!n||c[n].isOpen||(c[n].isFlag?(c[n]={...c[n],isFlag:!1},e.textContent=""):(c[n]={...c[n],isFlag:!0},e.textContent=H))};if(D){f.addEventListener("touchstart",e=>{b||(b=setTimeout(()=>{I=!0,T(e)},P))});const t=e=>{I&&e.preventDefault(),b&&(clearTimeout(b),b=null,I=!1)};f.addEventListener("touchend",e=>{t(e)}),f.addEventListener("touchcancel",e=>{t(e)})}else f.addEventListener("contextmenu",t=>{t.preventDefault(),T(t)});W(m);m==null||m.appendChild(f);C();
